/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package dinnamus.ui.conectividade;

import br.com.log.LogDinnamus;
import br.com.ui.JTableDinnamuS;
import br.com.ui.MetodosUI_Auxiliares_1;
import br.com.ui.TbDinnamuSObject;
import br.data.DataHora;
import br.manipulararquivos.ManipulacaoArquivo2;
import com.boletos.BoletosInfra;
import com.pdf.CustomPDFReader;
import com.rest.boletos.ViewBoletosAbertos;
import com.rest.boletos.ViewBoletosPagos;
import java.io.File;
import java.io.FileOutputStream;
import java.util.Date;
import java.sql.Timestamp;
import java.text.SimpleDateFormat;
import java.util.List;
import javax.swing.SwingConstants;
import pdv.entidade.OffPdvDsw;

/**
 *
 * @author DSWM
 */
public class frmBoletosDSW extends javax.swing.JDialog {

    /**
     * Creates new form frmBoletosDSW
     */
    boolean iniciouOK = false;
    boolean conexaoNET =false;
    private BoletosInfra boletosInfra = new BoletosInfra();
    public frmBoletosDSW(java.awt.Frame parent, boolean modal) {
        super(parent, modal);
        initComponents();
       iniciouOK = iniciarUI();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        PainelTitulo = new javax.swing.JPanel();
        jLabel19 = new javax.swing.JLabel();
        btFechar2 = new javax.swing.JButton();
        PainelPrincipal = new javax.swing.JPanel();
        PainelServicosInfra = new javax.swing.JPanel();
        dbgBoletosAbertos = new br.com.ui.JTableDinnamuS();
        jLabel3 = new javax.swing.JLabel();
        PainelServicosApp = new javax.swing.JPanel();
        dbgboletosPagos = new br.com.ui.JTableDinnamuS();
        jLabel2 = new javax.swing.JLabel();
        PainelDadosUltiimoAcesso = new javax.swing.JPanel();
        jLabel4 = new javax.swing.JLabel();
        lblUltimoAcesso = new javax.swing.JLabel();
        Painelbotoes1 = new javax.swing.JPanel();
        btAtualizarDadosPDV1 = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setMinimumSize(new java.awt.Dimension(791, 483));
        setUndecorated(true);
        setPreferredSize(new java.awt.Dimension(791, 483));
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowOpened(java.awt.event.WindowEvent evt) {
                formWindowOpened(evt);
            }
        });
        getContentPane().setLayout(new java.awt.GridBagLayout());

        PainelTitulo.setBackground(new java.awt.Color(0, 0, 0));
        PainelTitulo.setLayout(new java.awt.GridBagLayout());

        jLabel19.setBackground(new java.awt.Color(0, 0, 0));
        jLabel19.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel19.setForeground(new java.awt.Color(255, 255, 255));
        jLabel19.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        jLabel19.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dinnamus/ui/img/icons8-código-de-barras-32.png"))); // NOI18N
        jLabel19.setText("Boletos");
        jLabel19.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        jLabel19.setOpaque(true);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.4;
        gridBagConstraints.insets = new java.awt.Insets(0, 6, 0, 0);
        PainelTitulo.add(jLabel19, gridBagConstraints);

        btFechar2.setFont(new java.awt.Font("Tahoma", 1, 10)); // NOI18N
        btFechar2.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dinnamus/ui/img/Shut down_16x16.png"))); // NOI18N
        btFechar2.setMnemonic('x');
        btFechar2.setToolTipText("");
        btFechar2.setBorderPainted(false);
        btFechar2.setOpaque(false);
        btFechar2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btFechar2ActionPerformed(evt);
            }
        });
        btFechar2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                btFechar2KeyPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 3);
        PainelTitulo.add(btFechar2, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        getContentPane().add(PainelTitulo, gridBagConstraints);

        PainelPrincipal.setBackground(new java.awt.Color(255, 255, 204));
        PainelPrincipal.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        PainelPrincipal.setName(""); // NOI18N
        PainelPrincipal.setLayout(new java.awt.GridBagLayout());

        PainelServicosInfra.setBackground(new java.awt.Color(255, 255, 255));
        PainelServicosInfra.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        PainelServicosInfra.setLayout(new java.awt.GridBagLayout());

        dbgBoletosAbertos.setExibirBarra(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.2;
        gridBagConstraints.weighty = 0.2;
        PainelServicosInfra.add(dbgBoletosAbertos, gridBagConstraints);

        jLabel3.setText("Boletos Abertos");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.insets = new java.awt.Insets(0, 4, 0, 0);
        PainelServicosInfra.add(jLabel3, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.2;
        gridBagConstraints.weighty = 0.3;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        PainelPrincipal.add(PainelServicosInfra, gridBagConstraints);

        PainelServicosApp.setBackground(new java.awt.Color(255, 255, 255));
        PainelServicosApp.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));
        PainelServicosApp.setLayout(new java.awt.GridBagLayout());

        dbgboletosPagos.setExibirBarra(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.2;
        gridBagConstraints.weighty = 0.2;
        PainelServicosApp.add(dbgboletosPagos, gridBagConstraints);

        jLabel2.setText("Boletos Pagos");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.LINE_START;
        gridBagConstraints.insets = new java.awt.Insets(0, 4, 0, 0);
        PainelServicosApp.add(jLabel2, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.2;
        gridBagConstraints.weighty = 0.3;
        gridBagConstraints.insets = new java.awt.Insets(7, 7, 7, 7);
        PainelPrincipal.add(PainelServicosApp, gridBagConstraints);

        PainelDadosUltiimoAcesso.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 0, 0)));

        jLabel4.setText("Exibindo informações obtidas em : ");
        PainelDadosUltiimoAcesso.add(jLabel4);
        PainelDadosUltiimoAcesso.add(lblUltimoAcesso);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.insets = new java.awt.Insets(8, 8, 8, 8);
        PainelPrincipal.add(PainelDadosUltiimoAcesso, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.1;
        gridBagConstraints.weighty = 0.2;
        getContentPane().add(PainelPrincipal, gridBagConstraints);

        Painelbotoes1.setBackground(new java.awt.Color(0, 0, 0));
        Painelbotoes1.setLayout(new java.awt.GridBagLayout());

        btAtualizarDadosPDV1.setBackground(new java.awt.Color(0, 0, 0));
        btAtualizarDadosPDV1.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        btAtualizarDadosPDV1.setForeground(new java.awt.Color(255, 255, 255));
        btAtualizarDadosPDV1.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dinnamus/ui/img/icons8-pesquisar-24.png"))); // NOI18N
        btAtualizarDadosPDV1.setMnemonic('G');
        btAtualizarDadosPDV1.setToolTipText("Exibir PDF boleto aberto");
        btAtualizarDadosPDV1.setBorderPainted(false);
        btAtualizarDadosPDV1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btAtualizarDadosPDV1ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.ipady = 11;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.insets = new java.awt.Insets(8, 313, 8, 313);
        Painelbotoes1.add(btAtualizarDadosPDV1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        getContentPane().add(Painelbotoes1, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btFechar2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btFechar2ActionPerformed
        try {
            //--ValorFinalPosDesconto=  ValorVendaPDV - nDescontoLiberado - DescontoAtacadoLiberado + AcrescimoLiberado;  //FormatarNumero.FormatarNumero(txtValorFinal.getValue().toString());
            //DAO_RepositorioLocal.RollBack_Statment();
            dispose();
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
        }
    }//GEN-LAST:event_btFechar2ActionPerformed

    private void btFechar2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_btFechar2KeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_btFechar2KeyPressed

    private void btAtualizarDadosPDV1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btAtualizarDadosPDV1ActionPerformed
        // TODO add your handling code here:
        selecionarBoleto();
    }//GEN-LAST:event_btAtualizarDadosPDV1ActionPerformed
    
    private void selecionarBoleto(){
        try {
            Integer TratarLinhaSelecionada = dbgBoletosAbertos.getLinhaAtual();
            if(TratarLinhaSelecionada!=null && TratarLinhaSelecionada>=0){
                
                ViewBoletosAbertos getViewBoletosAbertos = (ViewBoletosAbertos)dbgBoletosAbertos.getModeloObjeto().getRs().get(TratarLinhaSelecionada);
                if(getViewBoletosAbertos!=null){
                    
                    String nomePDF = ManipulacaoArquivo2.getDiretorioTemp() + ManipulacaoArquivo2.getSeparadorDiretorio() + getViewBoletosAbertos.getResponsavelfinanceiro() + "-" +  
                            DataHora.getCampoFormatado("dd-MM-yyyy",getViewBoletosAbertos.getDatadovencimento())+ ".pdf";
                    FileOutputStream f = new FileOutputStream(new File(nomePDF));
                    
                    f.write(getViewBoletosAbertos.getPdf());
                    f.close();
                    
                   new CustomPDFReader(nomePDF).ExibirUI();
                    
                }
            }else{
                MetodosUI_Auxiliares_1.MensagemAoUsuarioSimplesAVISO( "Não foi selecionado nenhum boleto aberto","Visualizar boleto aberto");
            }
        
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
            
        }
    }
    
    private void formWindowOpened(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowOpened
        // TODO add your handling code here:
        if(!iniciouOK ){
            dispose();
        }else{
            atualizarUI_DbgboletosAberto();
        }
    }//GEN-LAST:event_formWindowOpened

    private boolean iniciarUI(){
        try {
            
            
            
            List<OffPdvDsw> pdvdsw = boletosInfra.getPDVDSW();
            if(pdvdsw!=null && pdvdsw.isEmpty()){
                OffPdvDsw getpdvdsw = pdvdsw.get(0);
                Date timeUltimoAcesso = getpdvdsw.getUltimoacesso();//pdvdsw.getTime("ultimoacesso");
                SimpleDateFormat simpleDateFormat = new SimpleDateFormat("dd/MM/yyyy HH:mm:ss");
                lblUltimoAcesso.setText(simpleDateFormat.format(timeUltimoAcesso));
            }
           
            if(!iniciarUI_DbgboletosAberto()){return false;}
            
            
            if(!iniciarUI_DbgboletosPagos()){return false;}
          
            
            return true;
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
            return false;
        }
    }
    private boolean atualizarUI_DbgboletosAberto(){
        try {
            List<ViewBoletosAbertos> BoletosAberto = boletosInfra.BoletosAberto();

            TbDinnamuSObject dinnamuSObject = new TbDinnamuSObject(BoletosAberto);

            dbgBoletosAbertos.setModeloObjeto(dinnamuSObject);
            
              return true;
        } catch (Exception e) {
              LogDinnamus.Log(e, true);
            return false;
        }
    }
    
     private boolean atualizarUI_DbgboletosPagos(){
        try {
            List<ViewBoletosPagos> BoletosPagos = boletosInfra.BoletosPagos();

            TbDinnamuSObject dinnamuSObject = new TbDinnamuSObject(BoletosPagos);

            dbgboletosPagos.setModeloObjeto(dinnamuSObject);
            
              return true;
        } catch (Exception e) {
              LogDinnamus.Log(e, true);
            return false;
        }
    }
    
    private boolean iniciarUI_DbgboletosAberto(){
        try {
            
            dbgBoletosAbertos.setAjustaColunaAoPainel(true);
            dbgBoletosAbertos.setColunaComTamanhosEmPercentual(true);
         
   
            dbgBoletosAbertos.addClColunas("datadovencimento", "Vencto.", 20,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Data);
            dbgBoletosAbertos.addClColunas("valor", "Valor", 30,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Moeda);
            dbgBoletosAbertos.addClColunas("id", "ID Boleto", 20);
            dbgBoletosAbertos.addClColunas("nossonumero", "Nosso.Nro", 30);
           
            atualizarUI_DbgboletosAberto();
            
          
            
            
            return true;
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
            return false;
        }
    }
    
     private boolean iniciarUI_DbgboletosPagos(){
        try { 
            
            dbgboletosPagos.setAjustaColunaAoPainel(true);
            dbgboletosPagos.setColunaComTamanhosEmPercentual(true);
            dbgboletosPagos.addClColunas("dtdatapago", "Dt.Operação", 15,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Data);
            dbgboletosPagos.addClColunas("status", "Operação", 15);
            dbgboletosPagos.addClColunas("valorpago", "Valor", 20,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Moeda);
            dbgboletosPagos.addClColunas("datadovencimento", "Vencto.", 20,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Data);
            dbgboletosPagos.addClColunas("nossonumero", "Nosso.Nro", 20,SwingConstants.RIGHT, JTableDinnamuS.FormatoColuna.Data);
            dbgboletosPagos.addClColunas("id", "ID Boleto", 10);
           
            atualizarUI_DbgboletosPagos();
            
          
            
            
            return true;
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
            return false;
        }
    }
     
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel PainelDadosUltiimoAcesso;
    private javax.swing.JPanel PainelPrincipal;
    private javax.swing.JPanel PainelServicosApp;
    private javax.swing.JPanel PainelServicosInfra;
    private javax.swing.JPanel PainelTitulo;
    private javax.swing.JPanel Painelbotoes1;
    private javax.swing.JButton btAtualizarDadosPDV1;
    private javax.swing.JButton btFechar2;
    private br.com.ui.JTableDinnamuS dbgBoletosAbertos;
    private br.com.ui.JTableDinnamuS dbgboletosPagos;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel lblUltimoAcesso;
    // End of variables declaration//GEN-END:variables
}
