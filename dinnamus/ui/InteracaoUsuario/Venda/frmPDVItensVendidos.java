/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * frmPDVItensVendidos.java
 *
 * Created on 01/08/2010, 15:35:00
 */

package dinnamus.ui.InteracaoUsuario.Venda;

import br.com.generica.Dao_Generica;
import br.com.info.Sistema;
import br.com.log.LogDinnamus;
import br.com.repositorio.DAO_RepositorioLocal;
import br.com.ui.MetodosUI_Auxiliares_1;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.sql.ResultSet;

/**
 *
 * @author dti
 */
public class frmPDVItensVendidos extends javax.swing.JDialog {

    /** Creates new form frmPDVItensVendidos */
    //int nCodigoNota=0;
    private Object[] objLinha=null;
    public void Inicializar(Long nCodigoNota, int nQtItens) {
        InicializarUI(nCodigoNota, nQtItens);
    }
    public frmPDVItensVendidos(java.awt.Frame parent, boolean modal) {
        super(parent, modal);        
        initComponents();
        this.setLocationRelativeTo(null);
        //InicializarUI(nCodigoNota, nQtItens)
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        PainelCorpo = new javax.swing.JPanel();
        dbgItens = new br.com.ui.JTableDinnamuS();
        btCancelarItem = new javax.swing.JButton();
        PainelTopo = new javax.swing.JPanel();
        lblTitulo = new javax.swing.JLabel();
        btFechar = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Itens Vendidos");
        setMinimumSize(new java.awt.Dimension(580, 380));
        setUndecorated(true);
        setPreferredSize(new java.awt.Dimension(580, 380));
        getContentPane().setLayout(new java.awt.GridBagLayout());

        PainelCorpo.setBackground(new java.awt.Color(255, 255, 204));
        PainelCorpo.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        PainelCorpo.setLayout(new java.awt.GridBagLayout());
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.1;
        gridBagConstraints.weighty = 0.1;
        PainelCorpo.add(dbgItens, gridBagConstraints);

        btCancelarItem.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        btCancelarItem.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dinnamus/ui/img/delete.png"))); // NOI18N
        btCancelarItem.setMnemonic('c');
        btCancelarItem.setText("CANCELAR ITEM");
        btCancelarItem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btCancelarItemActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.ipadx = 18;
        gridBagConstraints.ipady = 24;
        gridBagConstraints.insets = new java.awt.Insets(10, 0, 14, 0);
        PainelCorpo.add(btCancelarItem, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.1;
        gridBagConstraints.weighty = 0.1;
        getContentPane().add(PainelCorpo, gridBagConstraints);

        PainelTopo.setBackground(new java.awt.Color(0, 0, 0));
        PainelTopo.setLayout(new java.awt.GridBagLayout());

        lblTitulo.setBackground(new java.awt.Color(0, 0, 0));
        lblTitulo.setFont(new java.awt.Font("Arial", 1, 18)); // NOI18N
        lblTitulo.setForeground(new java.awt.Color(255, 255, 255));
        lblTitulo.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        lblTitulo.setText("EXCLUIR ITEM DA VENDA");
        lblTitulo.setToolTipText("");
        lblTitulo.setOpaque(true);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.2;
        gridBagConstraints.insets = new java.awt.Insets(3, 10, 0, 0);
        PainelTopo.add(lblTitulo, gridBagConstraints);

        btFechar.setFont(new java.awt.Font("Tahoma", 1, 10)); // NOI18N
        btFechar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/dinnamus/ui/img/Shut down_16x16.png"))); // NOI18N
        btFechar.setMnemonic('x');
        btFechar.setToolTipText("");
        btFechar.setOpaque(false);
        btFechar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btFecharActionPerformed(evt);
            }
        });
        btFechar.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                btFecharKeyPressed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        PainelTopo.add(btFechar, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;
        gridBagConstraints.weightx = 0.1;
        getContentPane().add(PainelTopo, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btCancelarItemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btCancelarItemActionPerformed
        // TODO add your handling code here:
        SelecionarItem();
    }//GEN-LAST:event_btCancelarItemActionPerformed

    private void btFecharActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btFecharActionPerformed
        try {
           fechar();
        } catch (Exception e) {
            LogDinnamus.Log(e, true);
        }
    }//GEN-LAST:event_btFecharActionPerformed

    private void btFecharKeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_btFecharKeyPressed
        // TODO add your handling code here:
    }//GEN-LAST:event_btFecharKeyPressed

    /**
    * @param args the command line arguments
    */
    public static void main(String args[]) {
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                frmPDVItensVendidos dialog = new frmPDVItensVendidos(new javax.swing.JFrame(), true);
                dialog.addWindowListener(new java.awt.event.WindowAdapter() {
                    public void windowClosing(java.awt.event.WindowEvent e) {
                        System.exit(0);
                    }
                });
                dialog.setVisible(true);
            }
        });
    }
    public void fechar()
            {
                this.setVisible(false);
            }
    public void SelecionarItem()
    {
        try {
          
          Object[] Linha= dbgItens.TratarLinhaSelecionada(dbgItens.getjTable());
          if(Linha.length>0){
              if(Linha[1].toString().indexOf("<< CANCELADO >>")>=0){
                  MetodosUI_Auxiliares_1.MensagemAoUsuarioSimples(null, "O ITEM J√Å FOI CANCELADO", "CANCELAR ITEM", "AVISO");
              }else{                      
                  setObjLinha(dbgItens.TratarLinhaSelecionada(dbgItens.getjTable()));          
                  if(getObjLinha()!=null){
                      fechar();
                  }
              }
          }
            
        } catch (Exception e) {
            LogDinnamus.Log(e);
        }
          
    }
    private boolean InicializarUI(Long nCodigo, int nQtItens)
    {
        boolean bRet=false;
        String sql="select seq, (case when codmov='apagar' then  '<< CANCELADO >> '  || Descricao else Descricao end) Descricao,Preco,Quantidade,Total,Idunico from itensorc where codigo=" + nCodigo + " order by idunico";
        //dbgItens.IniciarTabela(sql, 20, "idunico", nQtItens,true);
        dbgItens.TamanhoColunas( new int[]{50,400,100,100,100,1});
        dbgItens.setRsDados(DAO_RepositorioLocal.GerarResultSet(sql,ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_READ_ONLY));
        dbgItens.getjTable().addKeyListener(
            new KeyListener() {

            public void keyTyped(KeyEvent e) {}
            public void keyPressed(KeyEvent e) {
                if(e.getKeyChar()=='\n'){
                
                    
                    SelecionarItem();
                    e.consume();
                }
                else if(e.getKeyChar()=='\u001b'){
                    fechar();
                }
            }
            public void keyReleased(KeyEvent e) {}
        }

         );
        dbgItens.getjTable().requestFocus();
               
        return bRet;
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel PainelCorpo;
    private javax.swing.JPanel PainelTopo;
    private javax.swing.JButton btCancelarItem;
    private javax.swing.JButton btFechar;
    private br.com.ui.JTableDinnamuS dbgItens;
    private javax.swing.JLabel lblTitulo;
    // End of variables declaration//GEN-END:variables

    /**
     * @return the objLinha
     */
    public Object[] getObjLinha() {
        return objLinha;
    }

    /**
     * @param objLinha the objLinha to set
     */
    public void setObjLinha(Object[] objLinha) {
        this.objLinha = objLinha;
    }

}
